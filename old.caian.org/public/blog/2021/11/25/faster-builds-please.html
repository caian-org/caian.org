<!DOCTYPE html><html> <meta name="generator" content="Jekyll v4.2.2"/> <meta property="og:title" content="Faster builds, please"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Itâ€™s been only a couple of days since Iâ€™ve started again and more things have changed over here. Iâ€™ve quickly discovered, after half a dozen deploys, about some of the inconveniences of Cloudflare Pages that people didnâ€™t seem to care enough to talk about. Hereâ€™s what Iâ€™ve noticed:"/> <meta property="og:description" content="Itâ€™s been only a couple of days since Iâ€™ve started again and more things have changed over here. Iâ€™ve quickly discovered, after half a dozen deploys, about some of the inconveniences of Cloudflare Pages that people didnâ€™t seem to care enough to talk about. Hereâ€™s what Iâ€™ve noticed:"/> <link rel="canonical" href="https://caian.org/blog/2021/11/25/faster-builds-please.html"/> <meta property="og:url" content="https://caian.org/blog/2021/11/25/faster-builds-please.html"/> <meta property="og:site_name" content="caian.org"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2021-11-25T00:00:00-03:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="Faster builds, please"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-25T00:00:00-03:00","datePublished":"2021-11-25T00:00:00-03:00","description":"Itâ€™s been only a couple of days since Iâ€™ve started again and more things have changed over here. Iâ€™ve quickly discovered, after half a dozen deploys, about some of the inconveniences of Cloudflare Pages that people didnâ€™t seem to care enough to talk about. Hereâ€™s what Iâ€™ve noticed:","headline":"Faster builds, please","mainEntityOfPage":{"@type":"WebPage","@id":"https://caian.org/blog/2021/11/25/faster-builds-please.html"},"url":"https://caian.org/blog/2021/11/25/faster-builds-please.html"}</script> <meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" type="image/png" href="/assets/imgs/favicon.ico"/><link rel="alternate" type="application/rss+xml" title="caian.org" href="https://caian.org/blog/feed.xml"/><link id="theme" rel="stylesheet" href="/assets/css/themes/main/bright.css"/><link id="syntax" rel="stylesheet" href="/assets/css/themes/main/syntax/bright.css"/><title>caian.org | blog</title><body><div class="main"> <a href="/blog">Back</a> | <a id="change-theme" href="#" onclick="changeTheme()">Dark theme</a><h1>Faster builds, please</h1> <div id="meta"> <p class="aleft"> <span class="tag-list"> <a href="https://caian.org/blog/tags/development">development</a> <a href="https://caian.org/blog/tags/updates">updates</a></span></p> <p class="aright"><span class="lighter">~2 mins read Â  2021-11-25</span></p> <div class="aclear"></div> </div> <p>Itâ€™s been only a couple of days since Iâ€™ve <a href="/blog/2021/11/06/starting-again.html">started again</a> and more things have changed over here. Iâ€™ve quickly discovered, after half a dozen deploys, about some of the inconveniences of Cloudflare Pages that people didnâ€™t seem to care enough to talk about. Hereâ€™s what Iâ€™ve noticed:</p> <ol> <li> <p><strong>The worker startup is painfully slow</strong>. Every time a new change hits GitHub, a new build is triggered on Pages and so a new worker must be started to actually build and release the website into the internet. And for some unknown reason, the startup process alone was taking half of the average needed time â€“ 5 to 6 minutes to run the entire pipeline and half of it was just to spin-up the VM (or container, I donâ€™t know). And this behaviour happened consistently.</p> </li> <li> <p><strong>The installation of dependencies are mandatory</strong>. If pages detects a manifest file â€“ <code class="language-plaintext highlighter-rouge">Pipfile</code>, <code class="language-plaintext highlighter-rouge">package.json</code>, <code class="language-plaintext highlighter-rouge">Gemfile</code> etc â€“ it <strong>will</strong> install of itâ€™s dependencies. You simply cannot skip this. This might not sound that bad, butâ€¦</p> </li> <li> <p><strong>Cloudflare Pages donâ€™t cache your build</strong>. No, Iâ€™m not talking about Cloudflareâ€™s CDN. Iâ€™m talking about all the node modules and other stuff generated at build time. Again, this might not sound that bad, but jekyll for instance relies on Ruby gems that binds to C code, which of course are system / arch-dependent and must be compiled every time. Having the option to specify a list of directories that must be cached between executions would greatly improve the build speed.</p> </li> </ol> <h2 id="so">So??</h2> <p>Yes, a 5 minutes pipeline is not a lot, but it felt wasteful, so I did some changesâ€¦</p> <ol> <li> <p><strong>The build is now being made on Github Actions</strong> and the modules / packages / libs are now cacheable. The first run took 5 minutes just to install and compile all the dependencies; the subsequent ones, only 4 seconds. An entire build pipeline takes no more than a minute now.</p> </li> <li> <p>The builded files â€“ HTML pages and stylesheets â€“ have their own place now: a <a href="https://github.com/caian-org/caian.org-dist" target="_blank" rel="noopener noreferrer">separate git repository</a>.</p> </li> <li> <p><strong>This site is not on Cloudflare Pages anymore</strong>.</p> </li> </ol> <p>The pipeline is a little more complex, but more faster (on average, 2 minutes from <code class="language-plaintext highlighter-rouge">git push</code> to a new site version be live on the internet). A <code class="language-plaintext highlighter-rouge">git commit</code> triggers the GitHub Action that builds the site and commits to the other repository, which in turn triggers <a href="https://render.com" target="_blank" rel="noopener noreferrer">Render</a> â€“ Iâ€™ve talked about this guy last post. Render can do itâ€™s job in a little more than a minute â€“ hereâ€™s what a build outlook looks like:</p> <div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">40</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Cloning</span> <span class="n">from</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/caian-org/caian.org-dist...</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">41</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Checking</span> <span class="n">out</span> <span class="n">commit</span> <span class="mi">081</span><span class="n">d48b</span> <span class="n">in</span> <span class="n">branch</span> <span class="n">master</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">54</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Downloading</span> <span class="n">cache</span><span class="p">...</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">57</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Downloaded</span> <span class="mf">5.0</span><span class="n">MB</span> <span class="n">in</span> <span class="mi">1</span><span class="n">s</span><span class="p">.</span> <span class="n">Extraction</span> <span class="n">took</span> <span class="mi">1</span><span class="n">s</span><span class="p">.</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">06</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Using</span> <span class="n">Python</span> <span class="n">version</span><span class="o">:</span> <span class="mf">3.7.10</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">10</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Empty</span> <span class="n">build</span> <span class="n">command</span><span class="p">;</span> <span class="n">skipping</span> <span class="n">build</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">25</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Uploading</span> <span class="n">build</span><span class="p">...</span>
<span class="n">Nov</span> <span class="mi">25</span> <span class="mi">12</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">52</span> <span class="n">AM</span>  <span class="o">==&gt;</span> <span class="n">Your</span> <span class="n">site</span> <span class="n">is</span> <span class="n">live</span> <span class="err">ðŸŽ‰</span>
</code></pre></div></div> <h2 id="where-will-you-be-next-month">Where will you be next month?</h2> <p>I donâ€™t plan to leave Render this soon, but Iâ€™ll not make any promises. If I could strip down one more build minute by going somewhere else, I would. For now Iâ€™m overall happy with this new format / build process.</p> <hr> <footer><a href="/">Home</a> | <a href="/blog/feed.xml">Subscribe with RSS</a> </footer> </div></body><script type="text/javascript" src="/assets/js/change-theme.js"></script></html>